{% extends 'base.html' %}
{% load static %}

{% block title %}Личный кабинет владельца{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{% static 'css/users/profile_owner.css' %}">
{% endblock %}

{% block content %}
<div class="owner-dashboard">
  <h2>Личный кабинет владельца</h2>
  {# Блоки заведений #}
  {% for place in places %}
    <div class="place-info-block">
      <img src="{{ place.image.url }}" alt="{{ place.name }}" class="place-info-img">
      <div class="place-info-details">
        <div class="place-info-title">{{ place.name }}</div>
        <div class="place-info-cat">
          Категории:
          {% for cat in place.categories.all %}
            {{ cat.name }}{% if not forloop.last %}, {% endif %}
          {% empty %}
            <span style="color:#888;">нет категорий</span>
          {% endfor %}
        </div>
        <div class="place-info-addr">
          Адреса:
          {% for addr in place.addresses.all %}
            {{ addr }}{% if not forloop.last %}; {% endif %}
          {% empty %}
            <span style="color:#888;">нет адреса</span>
          {% endfor %}
        </div>
        <div class="place-info-type">Тип: {{ place.get_type_display }}</div>
        <div class="place-info-type">Время работы: {{ place.working_hours }}</div>
      </div>
    </div>
  {% endfor %}

  {# Текущие заказы #}
  <h3>Актуальные заказы</h3>
  {% if orders %}
  <ul class="order-list">
      {% for order in orders %}
      <li class="order-card">
          <div class="order-header" onclick="this.parentElement.classList.toggle('active')">
          <div class="order-main-info">
              <div class="order-number">#{{ order.id }}</div>
              <div>
              <div class="order-datetime">{{ order.created_at|date:'d.m.Y H:i' }}</div>
              <div class="order-client">{{ order.user.username }}</div>
              </div>
          </div>
          <div class="order-toggle">∨</div>
          </div>
          <div class="order-details">
          <table class="order-items">
              <thead>
              <tr>
                  <th>Товар</th>
                  <th>Кол-во</th>
                  <th>Цена</th>
                  <th>Сумма</th>
              </tr>
              </thead>
              <tbody>
              {% for item in order.items.all %}
                  <tr>
                  <td>
                      {{ item.product.name }}
                      {% if item.options.all %}
                      <div class="item-options">
                          {% for option in item.options.all %}
                          <div class="item-option">
                              <span class="option-name">{{ option.option_group.name }}</span>
                              <span class="option-value">{{ option.name }}</span>
                              {% if option.price > 0 %}
                              <span class="option-price">+{{ option.price }} ₽</span>
                              {% endif %}
                          </div>
                          {% endfor %}
                      </div>
                      {% endif %}
                  </td>
                  <td>×{{ item.quantity }}</td>
                  <td>{{ item.price }} ₽</td>
                  <td>{{ item.total_price }} ₽</td>
                  </tr>
              {% endfor %}
              </tbody>
          </table>
          <div class="order-total">Итого: {{ order.total_price }} ₽</div>
          </div>
          {% if order.comment %}
          <div style="padding:0 1rem 1rem;color:#666;font-size:0.9rem;">
              <strong>Комментарий:</strong> {{ order.comment }}
          </div>
          {% endif %}
      </li>
      {% endfor %}
  </ul>
  {% else %}
  <div class="empty-state">Нет активных заказов</div>
  {% endif %}
</div>
{% endblock %}