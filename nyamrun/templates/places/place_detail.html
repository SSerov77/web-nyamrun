{% extends 'base.html' %}
{% load static %}
{% block title %}{{ place.name }}{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{% static 'css/place_detail.css' %}">
  <link rel="stylesheet" href="{% static 'css/modal.css' %}">
{% endblock %}

{% block content %}
<main class="main">
  <div class="main-content restaurant-page">

    <!-- Sidebar -->
    <aside class="menu-sidebar">
      <div class="back-link">
        <img src="{% static 'imgs/return-arrow.svg' %}" alt="return-arrow">
        <a href="{% url 'place_list' %}">Все заведения</a>
      </div>
      <nav class="menu-categories">
        <p>Меню</p>
        <ul>
          {% for cat_data in categories %}
            <a href="#{{ cat_data.category.slug }}">{{ cat_data.category.name }}</a>
          {% endfor %}
        </ul>
      </nav>
    </aside>

    <!-- Main restaurant section -->
    <section class="restaurant-main">
      <div class="restaurant-banner-container">
        <img src="{{ place.image.url }}" alt="{{ place.name }}" class="restaurant-banner-img">
      </div>

      {% for cat_data in categories %}
        <div class="menu-section">
          <h2 id="{{ cat_data.category.slug }}">{{ cat_data.category.name }}</h2>
          <div class="menu-items">
            {% for item in cat_data.items %}
            <div class="menu-item">
              <img src="{{ item.image.url }}" alt="{{ item.name }}" class="menu-item-img" />
              <p class="menu-item-price">{{ item.price }}₽</p>
              <p class="menu-item-name">{{ item.name }}</p>

              <!-- Кнопка открытия модального окна -->
              <button
                class="open-modal-btn add-btn"
                data-id="{{ item.id }}"
                data-modal-url="{% url 'product_modal_data' item.id %}"
                data-name="{{ item.name|escapejs }}"
                data-price="{{ item.price }}"
                data-image-url="{{ item.image.url }}"
                data-description="{{ item.description|default:''|linebreaksbr|escapejs }}"
              >
                + Добавить
              </button>
            </div>
            {% endfor %}
          </div>
        </div>
      {% endfor %}
    </section>

    <!-- Cart -->
    <aside class="cart" id="cart-sidebar">
      {% include 'places/partials/cart_sidebar.html' with cart=cart %}
    </aside>
  </div>

  <!-- Контейнер для модального окна -->
  <div id="modal-container" style="display:none;"></div>
</main>

<script>
  const CART_CLEAR_URL = "{% url 'cart_clear_ajax' %}";
  const CSRF_TOKEN = "{{ csrf_token }}";
</script>
<script src="{% static "js/cart/cart_clear.js" %}"></script>
<script type="module" src="{% static 'js/catalog/main.js' %}"></script>
{% endblock %}